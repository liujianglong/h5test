<!DOCTYPE html>
<html>
<head>
    <title>Scale Move and Rotate</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <style type="text/css">
        body {
            background-color: #B4EEB4;
        }

        .bg_image {
            text-align: center;
        }
    </style>
</head>
<body>
    <script src="../../asset/transform.js"></script>
    <script src="../../alloy_finger.js"></script>

<td style="position:relative;">
<img style="position:absolute; z-index:1;" class="bg_image" src="../../asset/bg.png" id="bgImg" alt="">
<img style="position:absolute; top:60px; left:30px; z-index:2" width="100" height="100" src="../../asset/test.png" id="emojiImg" alt="" />
<img style="position:absolute; top:90px; left:90px; z-index:3" width="120" height="120" src="../../asset/test3.png" id="maskImg" alt="" />
</td>
    <script>
        var el = document.getElementById("emojiImg");
        var elMask = document.getElementById("maskImg");
        var elBg = document.getElementById("bgImg");
        Transform(el);
        Transform(elMask);
        var initScale = 1;
        var bgW = elBg.width;
        var bgH = elBg.height;

        var gesture = new AlloyFinger(el, {
            rotate: function (evt) {
                el.rotateZ += evt.angle;
            },
            pinchStart: function () {
                initScale = el.scaleX;
            },
            multipointStart: function () {
                initScale = el.scaleX;
            },
            pinch: function (evt) {
                el.scaleX = el.scaleY = initScale * evt.scale;
            },
            pressMove: function (evt) {
                el.translateX += evt.deltaX;
                el.translateY += evt.deltaY;

                console.log("x:"+el.translateX+"   y:"+el.translateY+"   BG_W:"+bgW+"   BG_H:"+bgH+"   scale:"+el.scaleX+ "   rotate:"+el.rotateZ);

                el.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D";
            }
        });

        var gestureMask = new AlloyFinger(elMask, {
            rotate: function (evt) {
                el.rotateZ += evt.angle;
            },
            pinchStart: function () {
                initScale = el.scaleX;
            },
            multipointStart: function () {
                initScale = el.scaleX;
            },
            pinch: function (evt) {
                el.scaleX = el.scaleY = initScale * evt.scale;
            },
            pressMove: function (evt) {
                el.translateX += evt.deltaX;
                el.translateY += evt.deltaY;

                // el.scaleX=el.scaleY = el.scaleX*0.98;
                // el.rotateZ += 5;
                console.log("x:"+el.translateX+"   y:"+el.translateY+"   BG_W:"+bgW+"   BG_H:"+bgH+"   scale:"+el.scaleX+ "   rotate:"+el.rotateZ);
            }
        });

        function postImageParams(scale_, rotate_, translateX_, translateY_) {
            $.ajax({  
                type: "POST",  
                url: "../order/orderCancel.action",
                data: {"scale": scale_,"rotate":rotate_,"translateX":translateX_,"translateY_":translateY_},  
                dataType:"json",  
                async:false,  
                cache:false,  
                success: function(data){  
                    var member = eval("("+data+")"); //包数据解析为json 格式                                                            
                    /*if(member.success=="true"){  
                        flag = true;  
                    }else if(member.success=="false") {  
                        alert(member.info);  
                    }*/  
                },  
                error: function(json){  
                    alert("异常");  
                }  
            });  
        }
    </script>
</body>
</html>